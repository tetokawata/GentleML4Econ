<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>データ分析入門ノート - 3&nbsp; 予測モデルの推定</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./simplecomparison.html" rel="next">
<link href="./decision.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./prediction.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">予測モデルの推定</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">データ分析入門ノート</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">重要なコンセプト</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./decision.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">意思決定問題</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prediction.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">予測モデルの推定</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./simplecomparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">単純な比較分析</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./complexcomparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">複雑な比較分析</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#現実" id="toc-現実" class="nav-link active" data-scroll-target="#現実"><span class="header-section-number">3.1</span> 現実</a></li>
  <li><a href="#ml" id="toc-ml" class="nav-link" data-scroll-target="#ml"><span class="header-section-number">3.2</span> ML</a></li>
  <li><a href="#getting-started" id="toc-getting-started" class="nav-link" data-scroll-target="#getting-started"><span class="header-section-number">3.3</span> Getting Started</a></li>
  <li><a href="#予測問題" id="toc-予測問題" class="nav-link" data-scroll-target="#予測問題"><span class="header-section-number">3.4</span> 予測問題</a></li>
  <li><a href="#アイディア" id="toc-アイディア" class="nav-link" data-scroll-target="#アイディア"><span class="header-section-number">3.5</span> アイディア</a></li>
  <li><a href="#データ分割による評価" id="toc-データ分割による評価" class="nav-link" data-scroll-target="#データ分割による評価"><span class="header-section-number">3.6</span> データ分割による評価</a></li>
  <li><a href="#イメージ" id="toc-イメージ" class="nav-link" data-scroll-target="#イメージ"><span class="header-section-number">3.7</span> イメージ</a></li>
  <li><a href="#典型的誤解" id="toc-典型的誤解" class="nav-link" data-scroll-target="#典型的誤解"><span class="header-section-number">3.8</span> 典型的誤解</a></li>
  <li><a href="#母集団を用いた整理" id="toc-母集団を用いた整理" class="nav-link" data-scroll-target="#母集団を用いた整理"><span class="header-section-number">3.9</span> 母集団を用いた整理</a></li>
  <li><a href="#母集団" id="toc-母集団" class="nav-link" data-scroll-target="#母集団"><span class="header-section-number">3.10</span> 母集団</a></li>
  <li><a href="#例" id="toc-例" class="nav-link" data-scroll-target="#例"><span class="header-section-number">3.11</span> 例</a></li>
  <li><a href="#イメージ-1" id="toc-イメージ-1" class="nav-link" data-scroll-target="#イメージ-1"><span class="header-section-number">3.12</span> イメージ</a></li>
  <li><a href="#数値例-データ" id="toc-数値例-データ" class="nav-link" data-scroll-target="#数値例-データ"><span class="header-section-number">3.13</span> 数値例: データ</a></li>
  <li><a href="#数値例-予測モデル" id="toc-数値例-予測モデル" class="nav-link" data-scroll-target="#数値例-予測モデル"><span class="header-section-number">3.14</span> 数値例: 予測モデル</a></li>
  <li><a href="#数値例-予測モデル-1" id="toc-数値例-予測モデル-1" class="nav-link" data-scroll-target="#数値例-予測モデル-1"><span class="header-section-number">3.15</span> 数値例: 予測モデル</a></li>
  <li><a href="#数値例-予測モデルと母平均" id="toc-数値例-予測モデルと母平均" class="nav-link" data-scroll-target="#数値例-予測モデルと母平均"><span class="header-section-number">3.16</span> 数値例: 予測モデルと母平均</a></li>
  <li><a href="#不透明性-uncertainly" id="toc-不透明性-uncertainly" class="nav-link" data-scroll-target="#不透明性-uncertainly"><span class="header-section-number">3.17</span> 不透明性 (Uncertainly)</a></li>
  <li><a href="#sampling-model-uncertainly" id="toc-sampling-model-uncertainly" class="nav-link" data-scroll-target="#sampling-model-uncertainly"><span class="header-section-number">3.18</span> Sampling / Model Uncertainly</a></li>
  <li><a href="#sampling-uncertainlyの軽減" id="toc-sampling-uncertainlyの軽減" class="nav-link" data-scroll-target="#sampling-uncertainlyの軽減"><span class="header-section-number">3.19</span> Sampling Uncertainlyの軽減</a></li>
  <li><a href="#機械学習の利点" id="toc-機械学習の利点" class="nav-link" data-scroll-target="#機械学習の利点"><span class="header-section-number">3.20</span> 機械学習の利点</a></li>
  <li><a href="#機械学習の問題点" id="toc-機械学習の問題点" class="nav-link" data-scroll-target="#機械学習の問題点"><span class="header-section-number">3.21</span> 機械学習の問題点</a></li>
  <li><a href="#数値例-決定木" id="toc-数値例-決定木" class="nav-link" data-scroll-target="#数値例-決定木"><span class="header-section-number">3.22</span> 数値例: 決定木</a></li>
  <li><a href="#数値例-size-40-で分割" id="toc-数値例-size-40-で分割" class="nav-link" data-scroll-target="#数値例-size-40-で分割"><span class="header-section-number">3.23</span> 数値例: Size <span class="math inline">\(= 40\)</span> で分割</a></li>
  <li><a href="#モデルの評価" id="toc-モデルの評価" class="nav-link" data-scroll-target="#モデルの評価"><span class="header-section-number">3.24</span> モデルの評価</a></li>
  <li><a href="#予測モデルの評価-理想編" id="toc-予測モデルの評価-理想編" class="nav-link" data-scroll-target="#予測モデルの評価-理想編"><span class="header-section-number">3.25</span> 予測モデルの評価: 理想編</a></li>
  <li><a href="#予測モデルの評価-現実編" id="toc-予測モデルの評価-現実編" class="nav-link" data-scroll-target="#予測モデルの評価-現実編"><span class="header-section-number">3.26</span> 予測モデルの評価: 現実編</a></li>
  <li><a href="#イメージ-2" id="toc-イメージ-2" class="nav-link" data-scroll-target="#イメージ-2"><span class="header-section-number">3.27</span> イメージ</a></li>
  <li><a href="#補論-モデルを使い続けられるか" id="toc-補論-モデルを使い続けられるか" class="nav-link" data-scroll-target="#補論-モデルを使い続けられるか"><span class="header-section-number">3.28</span> 補論: モデルを使い続けられるか?</a></li>
  <li><a href="#極端なモデルの推定" id="toc-極端なモデルの推定" class="nav-link" data-scroll-target="#極端なモデルの推定"><span class="header-section-number">3.29</span> 極端なモデルの推定</a></li>
  <li><a href="#理想の予測モデル" id="toc-理想の予測モデル" class="nav-link" data-scroll-target="#理想の予測モデル"><span class="header-section-number">3.30</span> 理想の予測モデル</a></li>
  <li><a href="#完璧な予測は可能か" id="toc-完璧な予測は可能か" class="nav-link" data-scroll-target="#完璧な予測は可能か"><span class="header-section-number">3.31</span> 完璧な予測は可能か?</a></li>
  <li><a href="#予測モデルの推定-現実" id="toc-予測モデルの推定-現実" class="nav-link" data-scroll-target="#予測モデルの推定-現実"><span class="header-section-number">3.32</span> 予測モデルの推定: 現実</a></li>
  <li><a href="#現実的な方法-単純平均法" id="toc-現実的な方法-単純平均法" class="nav-link" data-scroll-target="#現実的な方法-単純平均法"><span class="header-section-number">3.33</span> 現実的な方法: 単純平均法</a></li>
  <li><a href="#現実的な方法-丸暗記法" id="toc-現実的な方法-丸暗記法" class="nav-link" data-scroll-target="#現実的な方法-丸暗記法"><span class="header-section-number">3.34</span> 現実的な方法: 丸暗記法</a></li>
  <li><a href="#複雑なモデルは望ましいのか" id="toc-複雑なモデルは望ましいのか" class="nav-link" data-scroll-target="#複雑なモデルは望ましいのか"><span class="header-section-number">3.35</span> 複雑なモデルは望ましいのか?</a></li>
  <li><a href="#補論-丸暗記が有効な場合" id="toc-補論-丸暗記が有効な場合" class="nav-link" data-scroll-target="#補論-丸暗記が有効な場合"><span class="header-section-number">3.36</span> 補論: 丸暗記が有効な場合</a></li>
  <li><a href="#中庸なモデルの推定" id="toc-中庸なモデルの推定" class="nav-link" data-scroll-target="#中庸なモデルの推定"><span class="header-section-number">3.37</span> 中庸なモデルの推定</a></li>
  <li><a href="#モデル選択集計" id="toc-モデル選択集計" class="nav-link" data-scroll-target="#モデル選択集計"><span class="header-section-number">3.38</span> モデル選択/集計</a></li>
  <li><a href="#概要" id="toc-概要" class="nav-link" data-scroll-target="#概要"><span class="header-section-number">3.39</span> 概要</a></li>
  <li><a href="#イメージ-bagging" id="toc-イメージ-bagging" class="nav-link" data-scroll-target="#イメージ-bagging"><span class="header-section-number">3.40</span> イメージ: Bagging</a></li>
  <li><a href="#randomforest-の利点" id="toc-randomforest-の利点" class="nav-link" data-scroll-target="#randomforest-の利点"><span class="header-section-number">3.41</span> RandomForest の利点</a></li>
  <li><a href="#数値例-random-forest" id="toc-数値例-random-forest" class="nav-link" data-scroll-target="#数値例-random-forest"><span class="header-section-number">3.42</span> 数値例: Random Forest</a></li>
  <li><a href="#big-dataは優れた予測モデルを保証するか" id="toc-big-dataは優れた予測モデルを保証するか" class="nav-link" data-scroll-target="#big-dataは優れた予測モデルを保証するか"><span class="header-section-number">3.43</span> Big dataは優れた予測モデルを保証するか?</a></li>
  <li><a href="#数値例-伝統的アプローチ5000事例" id="toc-数値例-伝統的アプローチ5000事例" class="nav-link" data-scroll-target="#数値例-伝統的アプローチ5000事例"><span class="header-section-number">3.44</span> 数値例: 伝統的アプローチ(5000事例)</a></li>
  <li><a href="#数値例-random-forest-with-large-sample-5000事例" id="toc-数値例-random-forest-with-large-sample-5000事例" class="nav-link" data-scroll-target="#数値例-random-forest-with-large-sample-5000事例"><span class="header-section-number">3.45</span> 数値例: Random Forest with large sample (5000事例)</a></li>
  <li><a href="#まとめ" id="toc-まとめ" class="nav-link" data-scroll-target="#まとめ"><span class="header-section-number">3.46</span> まとめ</a></li>
  <li><a href="#reference" id="toc-reference" class="nav-link" data-scroll-target="#reference"><span class="header-section-number">3.47</span> Reference</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-Prediction" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">予測モデルの推定</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="現実" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="現実"><span class="header-section-number">3.1</span> 現実</h2>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 228.00 44.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 40)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-40 224,-40 224,4 -4,4"></polygon>
<!-- X -->
<g id="node1" class="node">
<title>X</title>
<text text-anchor="middle" x="27" y="-15.6" font-family="Times,serif" font-size="8.00">X</text>
</g>
<!-- f_Y -->
<g id="node3" class="node">
<title>f_Y</title>
<text text-anchor="middle" x="110" y="-15.6" font-family="Times,serif" font-size="8.00">「未知の」メカニズム</text>
</g>
<!-- X&#45;&gt;f_Y -->
<g id="edge1" class="edge">
<title>X-&gt;f_Y</title>
<path fill="none" stroke="black" d="M54.23,-18C59.68,-18 65.13,-18 70.57,-18"></path>
<polygon fill="black" stroke="black" points="70.66,-18.35 71.66,-18 70.66,-17.65 70.66,-18.35"></polygon>
</g>
<!-- Y -->
<g id="node2" class="node">
<title>Y</title>
<text text-anchor="middle" x="193" y="-15.6" font-family="Times,serif" font-size="8.00">Y</text>
</g>
<!-- f_Y&#45;&gt;Y -->
<g id="edge2" class="edge">
<title>f_Y-&gt;Y</title>
<path fill="none" stroke="black" d="M148.26,-18C153.72,-18 159.18,-18 164.64,-18"></path>
<polygon fill="black" stroke="black" points="164.74,-18.35 165.74,-18 164.74,-17.65 164.74,-18.35"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="ml" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="ml"><span class="header-section-number">3.2</span> ML</h2>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 264.00 198.60" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 194.6)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-194.6 260,-194.6 260,4 -4,4"></polygon>
<!-- X -->
<g id="node1" class="node">
<title>X</title>
<text text-anchor="middle" x="27" y="-170.2" font-family="Times,serif" font-size="8.00">X</text>
</g>
<!-- f_Y -->
<g id="node3" class="node">
<title>f_Y</title>
<text text-anchor="middle" x="128" y="-170.2" font-family="Times,serif" font-size="8.00">「未知の」メカニズム</text>
</g>
<!-- X&#45;&gt;f_Y -->
<g id="edge1" class="edge">
<title>X-&gt;f_Y</title>
<path fill="none" stroke="black" d="M54.22,-172.6C65.76,-172.6 77.3,-172.6 88.84,-172.6"></path>
<polygon fill="black" stroke="black" points="88.96,-172.95 89.96,-172.6 88.96,-172.25 88.96,-172.95"></polygon>
</g>
<!-- g_Y -->
<g id="node4" class="node">
<title>g_Y</title>
<text text-anchor="middle" x="128" y="-88.6" font-family="Times,serif" font-size="8.00">複雑なモデル</text>
</g>
<!-- X&#45;&gt;g_Y -->
<g id="edge3" class="edge">
<title>X-&gt;g_Y</title>
<path fill="none" stroke="black" d="M48.92,-154.33C65.59,-141.19 88.47,-123.16 105.33,-109.87"></path>
<polygon fill="black" stroke="black" points="105.56,-110.13 106.13,-109.24 105.13,-109.58 105.56,-110.13"></polygon>
</g>
<!-- Y -->
<g id="node2" class="node">
<title>Y</title>
<text text-anchor="middle" x="229" y="-170.2" font-family="Times,serif" font-size="8.00">Y</text>
</g>
<!-- f_Y&#45;&gt;Y -->
<g id="edge2" class="edge">
<title>f_Y-&gt;Y</title>
<path fill="none" stroke="black" d="M166.27,-172.6C177.66,-172.6 189.06,-172.6 200.45,-172.6"></path>
<polygon fill="black" stroke="black" points="200.56,-172.95 201.56,-172.6 200.56,-172.25 200.56,-172.95"></polygon>
</g>
<!-- f_Y&#45;&gt;g_Y -->
<g id="edge5" class="edge">
<title>f_Y-&gt;g_Y</title>
<path fill="none" stroke="black" d="M128,-154.33C128,-141.39 128,-123.73 128,-110.5"></path>
<polygon fill="black" stroke="black" points="128.35,-110.24 128,-109.24 127.65,-110.24 128.35,-110.24"></polygon>
<text text-anchor="middle" x="134" y="-129.4" font-family="Times,serif" font-size="8.00">近似</text>
</g>
<!-- g_Y&#45;&gt;Y -->
<g id="edge4" class="edge">
<title>g_Y-&gt;Y</title>
<path fill="none" stroke="black" d="M149.87,-109.24C166.54,-122.37 189.42,-140.4 206.29,-153.7"></path>
<polygon fill="black" stroke="black" points="206.08,-153.98 207.08,-154.33 206.52,-153.43 206.08,-153.98"></polygon>
</g>
<!-- Est -->
<g id="node5" class="node">
<title>Est</title>
<text text-anchor="middle" x="128" y="-15.6" font-family="Times,serif" font-size="8.00">推定</text>
</g>
<!-- g_Y&#45;&gt;Est -->
<g id="edge6" class="edge">
<title>g_Y-&gt;Est</title>
<path fill="none" stroke="black" d="M128,-71.76C128,-60.75 128,-46.81 128,-36.03"></path>
<polygon fill="black" stroke="black" points="127.65,-71.81 128,-72.81 128.35,-71.81 127.65,-71.81"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="getting-started" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="getting-started"><span class="header-section-number">3.3</span> Getting Started</h2>
</section>
<section id="予測問題" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="予測問題"><span class="header-section-number">3.4</span> 予測問題</h2>
<ul>
<li><p>定義: 欠損情報 <span class="math inline">\(Y\)</span> を、観察できる変数 <span class="math inline">\(X\)</span> から予測するモデル <span class="math inline">\(g(X)\)</span> を構築する</p>
<ul>
<li><p>視聴履歴やいいね数 <span class="math inline">\((X) \rightarrow\)</span> 好む未視聴動画 <span class="math inline">\((Y)\)</span></p></li>
<li><p>メールの文名や件名 <span class="math inline">\((X) \rightarrow\)</span> 迷惑メール <span class="math inline">\((Y)\)</span></p></li>
<li><p>事業の内容や財務状況 <span class="math inline">\((X) \rightarrow\)</span> デフォルトリスク <span class="math inline">\((Y)\)</span></p></li>
</ul></li>
<li><p><span class="math inline">\(Y,X\)</span> が共に観察できるデータを活用できれば、推定方法がある程度確立されている (教師付き学習)</p></li>
</ul>
</section>
<section id="アイディア" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="アイディア"><span class="header-section-number">3.5</span> アイディア</h2>
<ul>
<li><p>過去の <span class="math inline">\(Y-X\)</span> の間の定量的なパターンを、データから抽出し、予測に利用する</p>
<ul>
<li><p>「1平米広い部屋は100万円高い価格で取引されがち」など</p>
<ul>
<li>そのデータ上にのみ偶然現れたパターンに注意する</li>
</ul></li>
</ul></li>
<li><p>予測の対象となる新しい事例と過去の事例(データ)との間に、一貫性が必要</p></li>
</ul>
</section>
<section id="データ分割による評価" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="データ分割による評価"><span class="header-section-number">3.6</span> データ分割による評価</h2>
<ul>
<li><p>予測モデルの性能をどのように評価するか</p>
<ul>
<li><p>実際に実装し、運用すれば、そのうち性能がわかるが…</p>
<ul>
<li>遅すぎる場合も多い</li>
</ul></li>
</ul></li>
<li><p>データをランダム２分割(Training/Test)に分割し、Trainingデータのみでモデルを作り、Testで評価する</p></li>
<li><p>典型的には、Testデータについて、平均二乗誤差 <span class="math display">\[(Y - 予測値)^2の平均値\]</span></p></li>
</ul>
</section>
<section id="イメージ" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="イメージ"><span class="header-section-number">3.7</span> イメージ</h2>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 198.29 216.80" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 212.8)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-212.8 194.29,-212.8 194.29,4 -4,4"></polygon>
<!-- Original -->
<g id="node1" class="node">
<title>Original</title>
<text text-anchor="middle" x="93.27" y="-187.8" font-family="Times,serif" font-size="10.00">データ</text>
</g>
<!-- Data -->
<g id="node2" class="node">
<title>Data</title>
<text text-anchor="middle" x="41.27" y="-103.8" font-family="Times,serif" font-size="10.00">訓練データ {Y,X}</text>
</g>
<!-- Original&#45;&gt;Data -->
<g id="edge1" class="edge">
<title>Original-&gt;Data</title>
<path fill="none" stroke="black" d="M82.24,-172.41C73.91,-159.28 62.48,-141.24 53.8,-127.56"></path>
<polygon fill="black" stroke="black" points="54.6,-126.86 52.11,-124.88 52.83,-127.98 54.6,-126.86"></polygon>
<text text-anchor="middle" x="93.77" y="-145.8" font-family="Times,serif" font-size="10.00">ランダム分割</text>
</g>
<!-- New -->
<g id="node3" class="node">
<title>New</title>
<text text-anchor="middle" x="145.27" y="-103.8" font-family="Times,serif" font-size="10.00">テストデータ {Y,X}</text>
</g>
<!-- Original&#45;&gt;New -->
<g id="edge2" class="edge">
<title>Original-&gt;New</title>
<path fill="none" stroke="black" d="M107.33,-172.77C111.68,-167.19 116.36,-160.86 120.27,-154.8 125.72,-146.36 131.04,-136.62 135.37,-128.2"></path>
<polygon fill="black" stroke="black" points="136.49,-128.31 136.92,-125.16 134.62,-127.36 136.49,-128.31"></polygon>
</g>
<!-- Model -->
<g id="node4" class="node">
<title>Model</title>
<text text-anchor="middle" x="43.27" y="-15" font-family="Times,serif" font-size="10.00">予測モデル g(X)</text>
</g>
<!-- Data&#45;&gt;Model -->
<g id="edge3" class="edge">
<title>Data-&gt;Model</title>
<path fill="none" stroke="black" d="M41.67,-88.65C41.99,-74.5 42.46,-54.4 42.8,-39.42"></path>
<polygon fill="black" stroke="black" points="43.86,-39.14 42.88,-36.11 41.76,-39.09 43.86,-39.14"></polygon>
<text text-anchor="middle" x="53.77" y="-58.2" font-family="Times,serif" font-size="14.00">推定</text>
</g>
<!-- New&#45;&gt;Model -->
<g id="edge4" class="edge">
<title>New-&gt;Model</title>
<path fill="none" stroke="black" d="M125.12,-88.65C108.08,-74.15 83.67,-53.38 65.95,-38.3"></path>
<polygon fill="black" stroke="black" points="66.35,-37.26 63.38,-36.11 64.99,-38.86 66.35,-37.26"></polygon>
</g>
<!-- Predict -->
<g id="node5" class="node">
<title>Predict</title>
<text text-anchor="middle" x="145.27" y="-15" font-family="Times,serif" font-size="10.00">予測値 Y^*</text>
</g>
<!-- Model&#45;&gt;Predict -->
<g id="edge5" class="edge">
<title>Model-&gt;Predict</title>
<path fill="none" stroke="black" d="M80.72,-18C91.56,-18 102.39,-18 113.22,-18"></path>
<polygon fill="black" stroke="black" points="113.28,-19.05 116.28,-18 113.28,-16.95 113.28,-19.05"></polygon>
</g>
<!-- Predict&#45;&gt;New -->
<g id="edge6" class="edge">
<title>Predict-&gt;New</title>
<path fill="none" stroke="black" d="M145.27,-36.11C145.27,-50.25 145.27,-70.36 145.27,-85.34"></path>
<polygon fill="black" stroke="black" points="144.22,-85.65 145.27,-88.65 146.32,-85.65 144.22,-85.65"></polygon>
<text text-anchor="middle" x="156.52" y="-59.4" font-family="Times,serif" font-size="10.00">テスト</text>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="典型的誤解" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="典型的誤解"><span class="header-section-number">3.8</span> 典型的誤解</h2>
<ul>
<li><p>機械学習を用いて推定すれば、予測性能が高いモデルが獲得できる</p></li>
<li><p>複雑な現象を予測するためには、複雑なモデルの方が望ましい</p></li>
<li><p>Big dataを用いれば、理想的な予測モデルを推定できる</p></li>
<li><p>予測性能が悪いモデルは、役に立たない</p></li>
</ul>
</section>
<section id="母集団を用いた整理" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="母集団を用いた整理"><span class="header-section-number">3.9</span> 母集団を用いた整理</h2>
<ul>
<li>母集団: 論点整理を目的とした<strong>概念</strong></li>
</ul>
</section>
<section id="母集団" class="level2" data-number="3.10">
<h2 data-number="3.10" class="anchored" data-anchor-id="母集団"><span class="header-section-number">3.10</span> 母集団</h2>
<ul>
<li><p>手元のデータに含まれる事例は、母分布(集団)から抽出されたと想定する</p>
<ul>
<li><p>本講義では、ランダムに選ばれるケースに集中する</p>
<ul>
<li>Random Sampling</li>
</ul></li>
<li><p>予測対象も、母分布からランダムに選ばれるとする</p></li>
</ul></li>
<li><p>一般にデータと母分布は、完全一致しない</p></li>
</ul>
</section>
<section id="例" class="level2" data-number="3.11">
<h2 data-number="3.11" class="anchored" data-anchor-id="例"><span class="header-section-number">3.11</span> 例</h2>
<ul>
<li><p>ユーザーの需要調査(どのようなサービスを望むか)</p>
<ul>
<li><p>データ: サービス利用者の中からランダムに選ばれた200名 (例: 20代が2割)</p>
<ul>
<li><p>母集団: 全サービス利用者 (例: 20代が2.2割)</p></li>
<li><p>予測対象: <span class="math inline">\(X\)</span> (年齢など)のみ判明している利用者</p></li>
</ul></li>
</ul></li>
<li><p>不動産取引価格の予測モデル</p>
<ul>
<li><p>データ: 2022年第二四半期のすべての取引事例</p>
<ul>
<li><p>母集団: 潜在的な全取引</p></li>
<li><p>予測対象: まだ取引されていない物件</p></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="イメージ-1" class="level2" data-number="3.12">
<h2 data-number="3.12" class="anchored" data-anchor-id="イメージ-1"><span class="header-section-number">3.12</span> イメージ</h2>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 217.73 198.60" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 194.6)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-194.6 213.73,-194.6 213.73,4 -4,4"></polygon>
<!-- Population -->
<g id="node1" class="node">
<title>Population</title>
<text text-anchor="middle" x="78.77" y="-169.6" font-family="Times,serif" font-size="10.00">母集団: 無数の事例 {Y,X}</text>
</g>
<!-- Data -->
<g id="node2" class="node">
<title>Data</title>
<text text-anchor="middle" x="33.77" y="-88" font-family="Times,serif" font-size="10.00">データ {Y,X}</text>
</g>
<!-- Population&#45;&gt;Data -->
<g id="edge1" class="edge">
<title>Population-&gt;Data</title>
<path fill="none" stroke="black" d="M69.01,-154.33C61.99,-141.92 52.51,-125.14 45.15,-112.12"></path>
<polygon fill="black" stroke="black" points="45.91,-111.33 43.52,-109.24 44.08,-112.37 45.91,-111.33"></polygon>
<text text-anchor="middle" x="77.77" y="-129.4" font-family="Times,serif" font-size="8.00">ランダム抽出</text>
</g>
<!-- New -->
<g id="node3" class="node">
<title>New</title>
<text text-anchor="middle" x="125.77" y="-88" font-family="Times,serif" font-size="10.00">新しい事例 {?,X}</text>
</g>
<!-- Population&#45;&gt;New -->
<g id="edge3" class="edge">
<title>Population-&gt;New</title>
<path fill="none" stroke="red" d="M89.07,-154.54C92.49,-148.84 96.31,-142.46 99.77,-136.6 104.49,-128.63 109.63,-119.83 114.09,-112.17"></path>
<polygon fill="red" stroke="red" points="115.1,-112.52 115.7,-109.4 113.28,-111.46 115.1,-112.52"></polygon>
</g>
<!-- Model -->
<g id="node4" class="node">
<title>Model</title>
<text text-anchor="middle" x="78.77" y="-15" font-family="Times,serif" font-size="10.00">予測モデル g(X)</text>
</g>
<!-- Data&#45;&gt;Model -->
<g id="edge2" class="edge">
<title>Data-&gt;Model</title>
<path fill="none" stroke="black" d="M44.66,-72.81C51.19,-62.52 59.5,-49.4 66.29,-38.7"></path>
<polygon fill="black" stroke="black" points="67.26,-39.12 67.98,-36.03 65.49,-38 67.26,-39.12"></polygon>
</g>
<!-- New&#45;&gt;Model -->
<g id="edge4" class="edge">
<title>New-&gt;Model</title>
<path fill="none" stroke="red" d="M114.39,-72.81C107.58,-62.52 98.9,-49.4 91.81,-38.7"></path>
<polygon fill="red" stroke="red" points="92.58,-37.95 90.04,-36.03 90.82,-39.11 92.58,-37.95"></polygon>
</g>
<!-- Predict -->
<g id="node5" class="node">
<title>Predict</title>
<text text-anchor="middle" x="180.77" y="-15" font-family="Times,serif" font-size="10.00">予測値 Y^*</text>
</g>
<!-- Model&#45;&gt;Predict -->
<g id="edge5" class="edge">
<title>Model-&gt;Predict</title>
<path fill="none" stroke="red" d="M116.22,-18C127.06,-18 137.89,-18 148.72,-18"></path>
<polygon fill="red" stroke="red" points="148.78,-19.05 151.78,-18 148.78,-16.95 148.78,-19.05"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="数値例-データ" class="level2" data-number="3.13">
<h2 data-number="3.13" class="anchored" data-anchor-id="数値例-データ"><span class="header-section-number">3.13</span> 数値例: データ</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="prediction_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="数値例-予測モデル" class="level2" data-number="3.14">
<h2 data-number="3.14" class="anchored" data-anchor-id="数値例-予測モデル"><span class="header-section-number">3.14</span> 数値例: 予測モデル</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="prediction_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="数値例-予測モデル-1" class="level2" data-number="3.15">
<h2 data-number="3.15" class="anchored" data-anchor-id="数値例-予測モデル-1"><span class="header-section-number">3.15</span> 数値例: 予測モデル</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="prediction_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="数値例-予測モデルと母平均" class="level2" data-number="3.16">
<h2 data-number="3.16" class="anchored" data-anchor-id="数値例-予測モデルと母平均"><span class="header-section-number">3.16</span> 数値例: 予測モデルと母平均</h2>
<ul>
<li>ここから想像の世界</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="prediction_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="不透明性-uncertainly" class="level2" data-number="3.17">
<h2 data-number="3.17" class="anchored" data-anchor-id="不透明性-uncertainly"><span class="header-section-number">3.17</span> 不透明性 (Uncertainly)</h2>
<ul>
<li><p>データ分析を含む事例分析の一般的課題</p>
<ul>
<li><p>独立した分析チームに<strong>同じ市場/社会</strong>の分析を依頼したとしても、同じ結論に到達し得ない</p>
<ul>
<li>誰がやっても、「水は100度で沸騰する」という結論を再現できる理科の実験とは対照的</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sampling-model-uncertainly" class="level2" data-number="3.18">
<h2 data-number="3.18" class="anchored" data-anchor-id="sampling-model-uncertainly"><span class="header-section-number">3.18</span> Sampling / Model Uncertainly</h2>
<ul>
<li><p>観察する事例が人によって異なる (<strong>Sampling uncertainly</strong>)</p>
<ul>
<li>伝統的なデータ分析における主たる関心</li>
</ul></li>
<li><p>事例の要約方法(モデル化)が属人的で、不透明 (<strong>Model uncertainly</strong>)</p>
<ul>
<li><p>多くの教科書で直接的な言及を避けてきた問題</p>
<ul>
<li>「理論や背景をしっかり踏まえて、適切なモデル化を行うべし」以上の提案が難しい</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="sampling-uncertainlyの軽減" class="level2" data-number="3.19">
<h2 data-number="3.19" class="anchored" data-anchor-id="sampling-uncertainlyの軽減"><span class="header-section-number">3.19</span> Sampling Uncertainlyの軽減</h2>
<ul>
<li><p>問題: データから観察できない価格決定要因の”偏り”が、データ固有の特徴を生み出す</p></li>
<li><p>対策: 多くの事例を集計(モデル化)し、傾向把握を行う</p>
<ul>
<li>初歩的な方法: よく似た労働者も高賃金を得ているか確認する</li>
</ul></li>
</ul>
</section>
<section id="機械学習の利点" class="level2" data-number="3.20">
<h2 data-number="3.20" class="anchored" data-anchor-id="機械学習の利点"><span class="header-section-number">3.20</span> 機械学習の利点</h2>
<ul>
<li><p>決定木を含む機械学習の手法は、明確な記述に基づくデータ主導のモデル化を行う</p>
<ul>
<li>Model Uncertainlyが軽減される</li>
</ul></li>
</ul>
</section>
<section id="機械学習の問題点" class="level2" data-number="3.21">
<h2 data-number="3.21" class="anchored" data-anchor-id="機械学習の問題点"><span class="header-section-number">3.21</span> 機械学習の問題点</h2>
<ul>
<li><p>データ主導のモデル生成は、Sampling uncertainlyを”複雑化”する</p>
<ul>
<li>データに応じてモデルが大きく変化しうるため</li>
</ul></li>
<li><p>伝統的な理論的性質(中心極限定理など)が適用できず、信頼区間などが近似計算できない</p>
<ul>
<li><p><span class="math inline">\(Y\)</span> に近い値を得ることが目標である予測問題では、通常大きな問題にならない</p></li>
<li><p>むしろモデル全体の予測性能を評価することが重要</p></li>
</ul></li>
</ul>
</section>
<section id="数値例-決定木" class="level2" data-number="3.22">
<h2 data-number="3.22" class="anchored" data-anchor-id="数値例-決定木"><span class="header-section-number">3.22</span> 数値例: 決定木</h2>
<ul>
<li>4名の分析者(ID 1-4) が独立してデータを収集し、決定木でモデルを推定したとすると、</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="prediction_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="数値例-size-40-で分割" class="level2" data-number="3.23">
<h2 data-number="3.23" class="anchored" data-anchor-id="数値例-size-40-で分割"><span class="header-section-number">3.23</span> 数値例: Size <span class="math inline">\(= 40\)</span> で分割</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="prediction_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>データとは無関係に、size = 40 で予測値が”誤って”変化する</li>
</ul>
</section>
<section id="モデルの評価" class="level2" data-number="3.24">
<h2 data-number="3.24" class="anchored" data-anchor-id="モデルの評価"><span class="header-section-number">3.24</span> モデルの評価</h2>
</section>
<section id="予測モデルの評価-理想編" class="level2" data-number="3.25">
<h2 data-number="3.25" class="anchored" data-anchor-id="予測モデルの評価-理想編"><span class="header-section-number">3.25</span> 予測モデルの評価: 理想編</h2>
<ul>
<li><p>どんな予測もまぐれあたりしうる</p>
<ul>
<li>平均的にうまく行くモデルを採用したい</li>
</ul></li>
<li><p>予測モデルを母分布に適用して評価する: 典型的には二乗誤差の母平均値を用いる <span class="math inline">\(E[(Y - g(X))^2]\)</span></p></li>
</ul>
</section>
<section id="予測モデルの評価-現実編" class="level2" data-number="3.26">
<h2 data-number="3.26" class="anchored" data-anchor-id="予測モデルの評価-現実編"><span class="header-section-number">3.26</span> 予測モデルの評価: 現実編</h2>
<ul>
<li><p>母分布は観察できないので、母分布に適用した際の予測性能は”推定する必要”がある</p>
<ul>
<li>母分布からランダムに選ばれた事例でテストしたい</li>
</ul></li>
<li><p>最も典型的な評価法は、データ分割: データをランダムに2分割 (訓練/テストデータ)し、訓練データのみでモデルを推定し、テストデータで評価</p></li>
</ul>
</section>
<section id="イメージ-2" class="level2" data-number="3.27">
<h2 data-number="3.27" class="anchored" data-anchor-id="イメージ-2"><span class="header-section-number">3.27</span> イメージ</h2>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 300.18 212.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 208)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-208 296.18,-208 296.18,4 -4,4"></polygon>
<!-- Population -->
<g id="node1" class="node">
<title>Population</title>
<text text-anchor="middle" x="55.16" y="-183" font-family="Times,serif" font-size="10.00">母集団: 無数の事例 {Y,X}</text>
</g>
<!-- Original -->
<g id="node2" class="node">
<title>Original</title>
<text text-anchor="middle" x="200.16" y="-183" font-family="Times,serif" font-size="10.00">データ</text>
</g>
<!-- Population&#45;&gt;Original -->
<g id="edge1" class="edge">
<title>Population-&gt;Original</title>
<path fill="none" stroke="black" d="M110.39,-186C130.5,-186 152.49,-186 169.67,-186"></path>
<polygon fill="black" stroke="black" points="170.04,-187.05 173.04,-186 170.04,-184.95 170.04,-187.05"></polygon>
<text text-anchor="middle" x="141.74" y="-192" font-family="Times,serif" font-size="10.00">ランダム抽出</text>
</g>
<!-- Data -->
<g id="node3" class="node">
<title>Data</title>
<text text-anchor="middle" x="143.16" y="-99" font-family="Times,serif" font-size="10.00">訓練データ {Y,X}</text>
</g>
<!-- Original&#45;&gt;Data -->
<g id="edge2" class="edge">
<title>Original-&gt;Data</title>
<path fill="none" stroke="black" d="M185.78,-167.87C181.27,-162.29 176.37,-155.98 172.16,-150 166.05,-141.33 159.81,-131.39 154.69,-122.88"></path>
<polygon fill="black" stroke="black" points="155.58,-122.33 153.14,-120.29 153.78,-123.4 155.58,-122.33"></polygon>
<text text-anchor="middle" x="194.66" y="-141" font-family="Times,serif" font-size="10.00">ランダム分割</text>
</g>
<!-- New -->
<g id="node4" class="node">
<title>New</title>
<text text-anchor="middle" x="247.16" y="-99" font-family="Times,serif" font-size="10.00">テストデータ {Y,X}</text>
</g>
<!-- Original&#45;&gt;New -->
<g id="edge3" class="edge">
<title>Original-&gt;New</title>
<path fill="none" stroke="black" d="M210.13,-167.61C217.66,-154.48 227.99,-136.44 235.84,-122.76"></path>
<polygon fill="black" stroke="black" points="236.79,-123.21 237.37,-120.08 234.97,-122.16 236.79,-123.21"></polygon>
</g>
<!-- Model -->
<g id="node5" class="node">
<title>Model</title>
<text text-anchor="middle" x="145.16" y="-15" font-family="Times,serif" font-size="10.00">予測モデル g(X)</text>
</g>
<!-- Data&#45;&gt;Model -->
<g id="edge4" class="edge">
<title>Data-&gt;Model</title>
<path fill="none" stroke="black" d="M143.58,-83.61C143.9,-70.59 144.34,-52.74 144.67,-39.1"></path>
<polygon fill="black" stroke="black" points="145.72,-39.11 144.74,-36.08 143.62,-39.06 145.72,-39.11"></polygon>
</g>
<!-- New&#45;&gt;Model -->
<g id="edge5" class="edge">
<title>New-&gt;Model</title>
<path fill="none" stroke="red" d="M225.53,-83.61C208.92,-70.26 186,-51.84 168.89,-38.08"></path>
<polygon fill="red" stroke="red" points="169.41,-37.15 166.41,-36.08 168.09,-38.78 169.41,-37.15"></polygon>
</g>
<!-- Predict -->
<g id="node6" class="node">
<title>Predict</title>
<text text-anchor="middle" x="247.16" y="-15" font-family="Times,serif" font-size="10.00">予測値 Y^*</text>
</g>
<!-- Model&#45;&gt;Predict -->
<g id="edge6" class="edge">
<title>Model-&gt;Predict</title>
<path fill="none" stroke="red" d="M182.61,-18C193.45,-18 204.28,-18 215.11,-18"></path>
<polygon fill="red" stroke="red" points="215.17,-19.05 218.16,-18 215.16,-16.95 215.17,-19.05"></polygon>
</g>
<!-- Predict&#45;&gt;New -->
<g id="edge7" class="edge">
<title>Predict-&gt;New</title>
<path fill="none" stroke="red" d="M247.16,-36.08C247.16,-49.03 247.16,-66.87 247.16,-80.58"></path>
<polygon fill="red" stroke="red" points="246.11,-80.61 247.16,-83.61 248.21,-80.61 246.11,-80.61"></polygon>
<text text-anchor="middle" x="258.41" y="-57" font-family="Times,serif" font-size="10.00">テスト</text>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="補論-モデルを使い続けられるか" class="level2" data-number="3.28">
<h2 data-number="3.28" class="anchored" data-anchor-id="補論-モデルを使い続けられるか"><span class="header-section-number">3.28</span> 補論: モデルを使い続けられるか?</h2>
<ul>
<li><p>モデル推定に用いるデータの母分布と、予測対象の母分布が異なれば、予測性能は悪化する</p>
<ul>
<li><p>高性能モデルでも、時代の変化/大きな社会的ショックの発生等の結果、性能が悪化しうる</p>
<ul>
<li>通常の設備と同様に、経年劣化/破壊されうる</li>
</ul></li>
</ul></li>
<li><p>定期的に予測性能を計り直し、再推定する必要がある</p>
<ul>
<li>Concept-Driftと呼ばれる</li>
</ul></li>
</ul>
</section>
<section id="極端なモデルの推定" class="level2" data-number="3.29">
<h2 data-number="3.29" class="anchored" data-anchor-id="極端なモデルの推定"><span class="header-section-number">3.29</span> 極端なモデルの推定</h2>
<ul>
<li>予測モデルの推定の原理を理解するために、極端な推定方法で何が生じるのか理解する</li>
</ul>
</section>
<section id="理想の予測モデル" class="level2" data-number="3.30">
<h2 data-number="3.30" class="anchored" data-anchor-id="理想の予測モデル"><span class="header-section-number">3.30</span> 理想の予測モデル</h2>
<ul>
<li><p>もし<strong>母集団</strong>をすべて活用して、モデル推定できるのであれば、理想の予測モデルは母平均 <span class="math inline">\(E[Y|X]\)</span></p>
<ul>
<li>予測誤差を平均二乗誤差で測定するのが前提</li>
</ul></li>
<li><p>「各グループ内での平均的傾向」よりも優れた予測は<strong>あり得ない</strong></p></li>
</ul>
</section>
<section id="完璧な予測は可能か" class="level2" data-number="3.31">
<h2 data-number="3.31" class="anchored" data-anchor-id="完璧な予測は可能か"><span class="header-section-number">3.31</span> 完璧な予測は可能か?</h2>
<ul>
<li><p>予測不可能な部分 <span class="math inline">\(Y - E[Y|X]\)</span> が発生</p>
<ul>
<li>削減不可能な誤差</li>
</ul></li>
<li><p>予測対象となる母集団(社会)、<span class="math inline">\(Y/X\)</span> が決まった時点で自動的に定まる</p>
<ul>
<li><p><span class="math inline">\(X\)</span> 内で個人差がある現象の予測は難しい</p>
<ul>
<li>人間行動やその相互作用で決まる現象 (例: 消費、貯蓄、出生、就業、賃金、等)は大きい傾向</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="予測モデルの推定-現実" class="level2" data-number="3.32">
<h2 data-number="3.32" class="anchored" data-anchor-id="予測モデルの推定-現実"><span class="header-section-number">3.32</span> 予測モデルの推定: 現実</h2>
<ul>
<li><p>母集団は観察できないので、データで置き換える必要がある</p>
<ul>
<li><p>単純なモデルを推定すると、母平均の複雑さを捉えられない</p></li>
<li><p>複雑なモデルを推定すると、データが偶然持った特徴を母平均の特徴と混同してしまう</p></li>
</ul></li>
</ul>
</section>
<section id="現実的な方法-単純平均法" class="level2" data-number="3.33">
<h2 data-number="3.33" class="anchored" data-anchor-id="現実的な方法-単純平均法"><span class="header-section-number">3.33</span> 現実的な方法: 単純平均法</h2>
<ul>
<li>単純な平均取引価格を予測値とする</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="prediction_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="現実的な方法-丸暗記法" class="level2" data-number="3.34">
<h2 data-number="3.34" class="anchored" data-anchor-id="現実的な方法-丸暗記法"><span class="header-section-number">3.34</span> 現実的な方法: 丸暗記法</h2>
<ul>
<li>各<span class="math inline">\(X\)</span> について、データ上の平均値を予測値とする</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="prediction_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="複雑なモデルは望ましいのか" class="level2" data-number="3.35">
<h2 data-number="3.35" class="anchored" data-anchor-id="複雑なモデルは望ましいのか"><span class="header-section-number">3.35</span> 複雑なモデルは望ましいのか?</h2>
<ul>
<li><p>丸暗記モデルは非常に複雑なモデルを生み出し、望ましいように思える</p>
<ul>
<li><p>現実は複雑</p></li>
<li><p><strong>推定に用いた</strong>データとの矛盾はない</p>
<ul>
<li>予測値とデータ上の平均値は、必ず一致する</li>
</ul></li>
</ul></li>
<li><p><strong>一般に予測性能は極めて悪い</strong></p>
<ul>
<li>少数の事例のみで計算れた平均値は、<span class="math inline">\(X\)</span> 以外の決定要因の偏りを反映してしまう</li>
</ul></li>
</ul>
</section>
<section id="補論-丸暗記が有効な場合" class="level2" data-number="3.36">
<h2 data-number="3.36" class="anchored" data-anchor-id="補論-丸暗記が有効な場合"><span class="header-section-number">3.36</span> 補論: 丸暗記が有効な場合</h2>
<ul>
<li><p><span class="math inline">\(X\)</span> 以外に <span class="math inline">\(Y\)</span> の決定要因がなければ、丸暗記は有効</p>
<ul>
<li>例: 判例予測、コンピュータの動作予測</li>
</ul></li>
<li><p>人間行動については、<span class="math inline">\(X\)</span> 以外の無数の決定要因が存在</p>
<ul>
<li><p>例: “双子”でも違う人生を歩む</p></li>
<li><p>丸暗記に向いていない</p></li>
</ul></li>
</ul>
</section>
<section id="中庸なモデルの推定" class="level2" data-number="3.37">
<h2 data-number="3.37" class="anchored" data-anchor-id="中庸なモデルの推定"><span class="header-section-number">3.37</span> 中庸なモデルの推定</h2>
<ul>
<li><p>多くの応用で平均値は単純すぎ、丸暗記は複雑すぎる</p></li>
<li><p>決定木については、最大分割回数などを変更することで、単純平均と丸暗記法の間を移行できる</p></li>
</ul>
</section>
<section id="モデル選択集計" class="level2" data-number="3.38">
<h2 data-number="3.38" class="anchored" data-anchor-id="モデル選択集計"><span class="header-section-number">3.38</span> モデル選択/集計</h2>
<ul>
<li><p>決定木の深さが異なれば、予測モデルは異なる</p></li>
<li><p>複数のモデルを”試作”し、予測性能を測定、最も性能が良いモデルを選ぶのは一つの方法</p></li>
<li><p>決定木については、複数のモデルを試作し、その予測結果を集計することがより有効な場合が多い</p>
<ul>
<li>モデル集計/アンサンブル法などと呼ばれる</li>
</ul></li>
</ul>
</section>
<section id="概要" class="level2" data-number="3.39">
<h2 data-number="3.39" class="anchored" data-anchor-id="概要"><span class="header-section-number">3.39</span> 概要</h2>
<ul>
<li><p>複雑なモデルを推定すると、母平均から大きく乖離した事例(ハズレ値)の影響を強く受ける</p>
<ul>
<li><p>予測結果を安定されるために、大量の予測モデルを作り、その平均値を最終予測とすることが有効 (Bagging)</p></li>
<li><p>一部の変数の使用を確率的に禁止することも併用できる (RandomForest)</p></li>
</ul></li>
</ul>
</section>
<section id="イメージ-bagging" class="level2" data-number="3.40">
<h2 data-number="3.40" class="anchored" data-anchor-id="イメージ-bagging"><span class="header-section-number">3.40</span> イメージ: Bagging</h2>
<ul>
<li>Bootstrap法を用いて、予測モデルを大量に作る (500-5000個程度)</li>
</ul>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<svg width="672" height="480" viewbox="0.00 0.00 390.08 332.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 328)">
<polygon fill="white" stroke="transparent" points="-4,4 -4,-328 386.08,-328 386.08,4 -4,4"></polygon>
<!-- Data -->
<g id="node1" class="node">
<title>Data</title>
<text text-anchor="middle" x="186.04" y="-309" font-family="Times,serif" font-size="10.00">訓練データ</text>
<text text-anchor="middle" x="186.04" y="-297" font-family="Times,serif" font-size="10.00">[Y={10,2,4},X={5,7,1}]</text>
</g>
<!-- Boot1 -->
<g id="node2" class="node">
<title>Boot1</title>
<text text-anchor="middle" x="55.04" y="-237" font-family="Times,serif" font-size="10.00">複製データ1</text>
<text text-anchor="middle" x="55.04" y="-225" font-family="Times,serif" font-size="10.00">[Y={2,2,4},X={7,7,1}]</text>
</g>
<!-- Data&#45;&gt;Boot1 -->
<g id="edge1" class="edge">
<title>Data-&gt;Boot1</title>
<path fill="none" stroke="black" d="M153.99,-287.88C136.55,-278.55 114.78,-266.92 96.1,-256.94"></path>
<polygon fill="black" stroke="black" points="97.68,-253.82 87.21,-252.19 94.38,-259.99 97.68,-253.82"></polygon>
</g>
<!-- Boot2 -->
<g id="node3" class="node">
<title>Boot2</title>
<text text-anchor="middle" x="186.04" y="-237" font-family="Times,serif" font-size="10.00">複製データ2</text>
<text text-anchor="middle" x="186.04" y="-225" font-family="Times,serif" font-size="10.00">[Y={10,2,2},X={5,7,7}]</text>
</g>
<!-- Data&#45;&gt;Boot2 -->
<g id="edge3" class="edge">
<title>Data-&gt;Boot2</title>
<path fill="none" stroke="black" d="M186.04,-287.7C186.04,-279.98 186.04,-270.71 186.04,-262.11"></path>
<polygon fill="black" stroke="black" points="189.54,-262.1 186.04,-252.1 182.54,-262.1 189.54,-262.1"></polygon>
</g>
<!-- Boot3 -->
<g id="node4" class="node">
<title>Boot3</title>
<text text-anchor="middle" x="322.04" y="-237" font-family="Times,serif" font-size="10.00">複製データ3</text>
<text text-anchor="middle" x="322.04" y="-225" font-family="Times,serif" font-size="10.00">[Y={10,10,4},X={5,5,1}]</text>
</g>
<!-- Data&#45;&gt;Boot3 -->
<g id="edge5" class="edge">
<title>Data-&gt;Boot3</title>
<path fill="none" stroke="black" d="M219.31,-287.88C237.5,-278.51 260.23,-266.81 279.68,-256.8"></path>
<polygon fill="black" stroke="black" points="281.35,-259.88 288.64,-252.19 278.15,-253.65 281.35,-259.88"></polygon>
</g>
<!-- Model1 -->
<g id="node5" class="node">
<title>Model1</title>
<text text-anchor="middle" x="81.04" y="-165" font-family="Times,serif" font-size="10.00">予測モデル1 </text>
<text text-anchor="middle" x="81.04" y="-153" font-family="Times,serif" font-size="10.00">g1(X)</text>
</g>
<!-- Boot1&#45;&gt;Model1 -->
<g id="edge2" class="edge">
<title>Boot1-&gt;Model1</title>
<path fill="none" stroke="black" d="M61.47,-215.7C64.4,-207.81 67.93,-198.3 71.18,-189.55"></path>
<polygon fill="black" stroke="black" points="74.49,-190.7 74.69,-180.1 67.93,-188.26 74.49,-190.7"></polygon>
</g>
<!-- Model2 -->
<g id="node6" class="node">
<title>Model2</title>
<text text-anchor="middle" x="186.04" y="-165" font-family="Times,serif" font-size="10.00">予測モデル2 </text>
<text text-anchor="middle" x="186.04" y="-153" font-family="Times,serif" font-size="10.00">g2(X)</text>
</g>
<!-- Boot2&#45;&gt;Model2 -->
<g id="edge4" class="edge">
<title>Boot2-&gt;Model2</title>
<path fill="none" stroke="black" d="M186.04,-215.7C186.04,-207.98 186.04,-198.71 186.04,-190.11"></path>
<polygon fill="black" stroke="black" points="189.54,-190.1 186.04,-180.1 182.54,-190.1 189.54,-190.1"></polygon>
</g>
<!-- Model3 -->
<g id="node7" class="node">
<title>Model3</title>
<text text-anchor="middle" x="293.04" y="-165" font-family="Times,serif" font-size="10.00">予測モデル3 </text>
<text text-anchor="middle" x="293.04" y="-153" font-family="Times,serif" font-size="10.00">g3(X)</text>
</g>
<!-- Boot3&#45;&gt;Model3 -->
<g id="edge6" class="edge">
<title>Boot3-&gt;Model3</title>
<path fill="none" stroke="black" d="M314.87,-215.7C311.61,-207.81 307.67,-198.3 304.04,-189.55"></path>
<polygon fill="black" stroke="black" points="307.19,-188 300.13,-180.1 300.72,-190.68 307.19,-188"></polygon>
</g>
<!-- Summary -->
<g id="node8" class="node">
<title>Summary</title>
<text text-anchor="middle" x="186.04" y="-87" font-family="Times,serif" font-size="10.00">平均</text>
</g>
<!-- Model1&#45;&gt;Summary -->
<g id="edge7" class="edge">
<title>Model1-&gt;Summary</title>
<path fill="none" stroke="black" d="M106.73,-143.88C120.33,-134.81 137.21,-123.55 151.9,-113.76"></path>
<polygon fill="black" stroke="black" points="153.88,-116.65 160.26,-108.19 149.99,-110.82 153.88,-116.65"></polygon>
</g>
<!-- Model2&#45;&gt;Summary -->
<g id="edge8" class="edge">
<title>Model2-&gt;Summary</title>
<path fill="none" stroke="black" d="M186.04,-143.7C186.04,-135.98 186.04,-126.71 186.04,-118.11"></path>
<polygon fill="black" stroke="black" points="189.54,-118.1 186.04,-108.1 182.54,-118.1 189.54,-118.1"></polygon>
</g>
<!-- Model3&#45;&gt;Summary -->
<g id="edge9" class="edge">
<title>Model3-&gt;Summary</title>
<path fill="none" stroke="black" d="M266.87,-143.88C253.01,-134.81 235.8,-123.55 220.83,-113.76"></path>
<polygon fill="black" stroke="black" points="222.6,-110.74 212.32,-108.19 218.77,-116.59 222.6,-110.74"></polygon>
</g>
<!-- Prediction -->
<g id="node9" class="node">
<title>Prediction</title>
<text text-anchor="middle" x="186.04" y="-15" font-family="Times,serif" font-size="10.00">最終予測</text>
</g>
<!-- Summary&#45;&gt;Prediction -->
<g id="edge10" class="edge">
<title>Summary-&gt;Prediction</title>
<path fill="none" stroke="black" d="M186.04,-71.7C186.04,-63.98 186.04,-54.71 186.04,-46.11"></path>
<polygon fill="black" stroke="black" points="189.54,-46.1 186.04,-36.1 182.54,-46.1 189.54,-46.1"></polygon>
</g>
</g>
</svg>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="randomforest-の利点" class="level2" data-number="3.41">
<h2 data-number="3.41" class="anchored" data-anchor-id="randomforest-の利点"><span class="header-section-number">3.41</span> RandomForest の利点</h2>
<ul>
<li><p>Bootstrapは、“ハズレ値”を含まないデータとそれを用いたモデルも生成される</p>
<ul>
<li>ハズレ値の影響を軽減できる</li>
</ul></li>
<li><p>変数の一部を確率的に使用できなくすることで、モデル間で用いる変数の多様性が促進される</p>
<ul>
<li>より多くの変数の情報が活用できる</li>
</ul></li>
<li><p>注: 実際にはモデル単位ではなく、サンプル分割ごとに、(元々の変数数のsquare root個)ランダムに使用禁止する</p></li>
</ul>
</section>
<section id="数値例-random-forest" class="level2" data-number="3.42">
<h2 data-number="3.42" class="anchored" data-anchor-id="数値例-random-forest"><span class="header-section-number">3.42</span> 数値例: Random Forest</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="prediction_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="big-dataは優れた予測モデルを保証するか" class="level2" data-number="3.43">
<h2 data-number="3.43" class="anchored" data-anchor-id="big-dataは優れた予測モデルを保証するか"><span class="header-section-number">3.43</span> Big dataは優れた予測モデルを保証するか?</h2>
<ul>
<li><p>「Big data <span class="math inline">\(=\)</span> サンプルサイズが多い」、のであれば、完璧な予測モデル <span class="math inline">\(g(X) = Y\)</span> を保証しない</p>
<ul>
<li>削減不可能な誤差 <span class="math inline">\(Y - E[Y|X]\)</span> が存在するため</li>
</ul></li>
<li><p>理想的な予測モデル <span class="math inline">\(g(X) = E[Y|X]\)</span> は保証できるか?</p>
<ul>
<li><p>伝統的な方法 <span class="math inline">\(=\)</span> 極めて強い仮定のもとでのみ可能</p></li>
<li><p>多くの機械学習 <span class="math inline">\(=\)</span> 緩やかな仮定で可能</p></li>
</ul></li>
</ul>
</section>
<section id="数値例-伝統的アプローチ5000事例" class="level2" data-number="3.44">
<h2 data-number="3.44" class="anchored" data-anchor-id="数値例-伝統的アプローチ5000事例"><span class="header-section-number">3.44</span> 数値例: 伝統的アプローチ(5000事例)</h2>
<ul>
<li><p>研究者が、「Size <span class="math inline">\(= 40\)</span> で分割する」と決定</p>
<ul>
<li>推定されうるモデルを限定する</li>
</ul></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="prediction_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="数値例-random-forest-with-large-sample-5000事例" class="level2" data-number="3.45">
<h2 data-number="3.45" class="anchored" data-anchor-id="数値例-random-forest-with-large-sample-5000事例"><span class="header-section-number">3.45</span> 数値例: Random Forest with large sample (5000事例)</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="prediction_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="まとめ" class="level2" data-number="3.46">
<h2 data-number="3.46" class="anchored" data-anchor-id="まとめ"><span class="header-section-number">3.46</span> まとめ</h2>
<ul>
<li><p>実際/理想/完璧な予測モデルの区別が重要</p></li>
<li><p>理想の予測モデル: <span class="math inline">\(g(X)=E[Y|X]\)</span></p>
<ul>
<li>個人差があれば、完璧な予測 <span class="math inline">\(g(X)=Y\)</span> は不可能</li>
</ul></li>
<li><p>限られたデータから推定されたモデルは、理想の予測モデルとはならない <span class="math inline">\(g(X)\neq E[Y|X]\)</span></p>
<ul>
<li>機械学習を用いて、近づけることは可能</li>
</ul></li>
<li><p>予測に使う前に、テストデータを用いた性能調査が必須</p></li>
</ul>
</section>
<section id="reference" class="level2" data-number="3.47">
<h2 data-number="3.47" class="anchored" data-anchor-id="reference"><span class="header-section-number">3.47</span> Reference</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./decision.html" class="pagination-link  aria-label=" &lt;span="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">意思決定問題</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./simplecomparison.html" class="pagination-link" aria-label="<span class='chapter-number'>4</span>&nbsp; <span class='chapter-title'>単純な比較分析</span>">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">単純な比較分析</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>